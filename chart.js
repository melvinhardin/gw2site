var vgGID = [
                991015174, //Mechanics
                190462791, //Ren - DPS
                811503596, //FB - DPS
                838391600, //Condi BS
                1058908524, //Power BS
                1785579560, //Weaver - DPS
                1657696023, //Slb - DPS
                1339404060, //Scourge - DPS
                1132006602, //Chrono - support
                1992582571, //DH - DPS
                1579402544, //Druid - support
                999598709 //Holo - DPS
              ];

var gorseGID = [
                1701108246, //Mechanics
                2103724885, //Ren - DPS
                971514289, //FB - DPS
                1478042865, //Condi BS
                949529543, //Power BS
                942005734, //Weaver - DPS
                1143826790, //Slb - DPS
                2075644689, //Scourge - DPS
                917443487, //Chrono - support
                2063296291, //DH - DPS
                134926887, //Druid - support
                147886991 //Holo - DPS
              ];

var sabGID = [
                985382956, //Mechanics
                902829492, //Ren - DPS
                1831565737, //FB - DPS
                1781476171, //Condi BS
                415691172, //Power BS
                302290482, //Weaver - DPS
                146341096, //Slb - DPS
                1780621990, //Scourge - DPS
                2031957583, //Chrono - support
                310204702, //DH - DPS
                1003900799, //Druid - support
                2102220127, //Holo - DPS
              ];

var slothGID = [
                1669870756, //Mechanics
                1340294905, //Ren - DPS
                1095908613, //FB - DPS
                1364298249, //Condi BS
                416934536, //Power BS
                1283816465, //Weaver - DPS
                1247044226, //Slb - DPS
                1615895992, //Scourge - DPS
                2110320791, //Chrono - support
                442952749, //DH - DPS
                1511154784, //Druid - support
                675250952, //Holo - DPS
              ];

var matthiasGID = [
                1235926549, //Mechanics
                1899713201, //Ren - DPS
                785982441, //FB - DPS
                236547606, //Condi BS
                233473682, //Power BS
                807394279, //Weaver - DPS
                1363984045, //Slb - DPS
                1842123078, //Scourge - DPS
                183521363, //Chrono - support
                736887254, //DH - DPS
                738926685, //Druid - support
                592679401 //Holo - DPS
              ];

var kcGID = [
                1047857245, //Mechanics
                898429453, //Ren - DPS
                1945768043, //FB - DPS
                913543469, //Condi BS
                214385073, //Power BS
                181826106, //Weaver - DPS
                1064131140, //Slb - DPS
                409634735, //Scourge - DPS
                447244827, //Chrono - support
                568195480, //DH - DPS
                1106663828, //Druid - support
                1638416332 //Holo - DPS
];

var xeraGID = [

                2042986611, //Mechanics
                868093496, //Ren - DPS
                1112758682, //FB - DPS
                1425335353, //Condi BS
                1495249342, //Power BS
                711582192, //Weaver - DPS
                1492374439, //Slb - DPS
                1541183482, //Scourge - DPS
                1710616243, //Chrono - support
                66929659, //DH - DPS
                31629366, //Druid - support
                1611150169 //Holo - DPS

];

var cairnGID = [
                1480282890, //Mechanics
                516807299, //Ren - DPS
                777978539, //FB - DPS
                119436615, //Condi BS
                858369185, //Power BS
                1015892548, //Weaver - DPS
                940026070, //Slb - DPS
                461179812, //Scourge - DPS
                1494700677, //Chrono - support
                683383792, //DH - DPS
                491765656, //Druid - support
                840142421 //Holo - DPS
  ];

var moGID = [
                809025824, //Mechanics
                208587933, //Ren - DPS
                913371253, //FB - DPS
                454378217, //Condi BS
                407633478, //Power BS
                423931843, //Weaver - DPS
                691809147, //Slb - DPS
                1576480614, //Scourge - DPS
                1144038318, //Chrono - support
                2000255683, //DH - DPS
                1154589258, //Druid - support
                85044944, //Holo - DPS
              ];

var samGID = [
                24437191, //Mechanics
                1178893327, //Ren - DPS
                432764259, //FB - DPS
                1715174861, //Condi BS
                1091748785, //Power BS
                1494053032, //Weaver - DPS
                1847580111, //Slb - DPS
                1466349830, //Scourge - DPS
                37001876, //Chrono - support
                289013984, //DH - DPS
                189665426, //Druid - support
                156270862, //Holo - DPS
              ];

var deimGID = [
                839279019, //Mechanics
                1990120780, //Ren - DPS
                1757068528, //FB - DPS
                476256543, //Condi BS
                1754608620, //Power BS
                611302285, //Weaver - DPS
                1549609737, //Slb - DPS
                1828913427, //Scourge - DPS
                32125949, //Chrono - DPS
                1445569781, //DH - DPS
                2074683547, //Druid - support
                1145777690, //Holo - DPS
              ];

var shGID = [
                20845267, //Mechanics
                2046268883, //Ren - DPS
                1263066701, //FB - DPS
                1200644838, //Condi BS
                691915459, //Power BS
                994224862, //Weaver - DPS
                1818820202, //Slb - DPS
                1651543817, //Scourge - DPS
                1042258015, //Chrono - support
                511857208, //DH - DPS
                558226147, //Druid - support
                841973933, //Holo - DPS
              ];

var dhuumGID = [
                2115074878, //Mechanics
                1348320342, //Ren - DPS
                701660904, //FB - DPS
                1763519200, //Condi BS
                1084207949, //Power BS
                1950577508, //Weaver - DPS
                1753352609, //Slb - DPS
                35660111, //Scourge - DPS
                1061457989, //Chrono - support
                1511397589, //DH - DPS
                1513342853, //Druid - support
                765123966, //Holo - DPS
              ];

var bossSheet = [
                'https://docs.google.com/spreadsheets/d/1L6Z8UZNQvgLi1Ve9ybmUjD6yLdDIz4D65c4FfQB3Sec/gviz/tq?gid=', //vg
                'https://docs.google.com/spreadsheets/d/1GiN7hb_m_aWAV811YhSddN2d32B7QnqfR45_lBNSUhM/gviz/tq?gid=', //gorse
                'https://docs.google.com/spreadsheets/d/1HAqrzdwqxxNTC4Q3nuU2salCq9Kpeuqp5axUZS4OR3A/gviz/tq?gid=', //sab
                'https://docs.google.com/spreadsheets/d/1JrI-o24_gZXyk_6B2EaLrzJ55rXxhW5SrfNPeCeBQfU/gviz/tq?gid=', //sloth
                'https://docs.google.com/spreadsheets/d/1Bn2UGa6Bw6uz0XDYqEnWKotWUsvh-eZf65C2NMMUnwQ/gviz/tq?gid=', //matthias
                'https://docs.google.com/spreadsheets/d/157oPsVQkOZyu4h_9d3RUM_Oi0vnEZwN8S5x6GaE444M/gviz/tq?gid=', //kc
                'https://docs.google.com/spreadsheets/d/18667ZIdJvlZKh5nEjsGzJ8N1YGEF8eBquekZ4konfSU/gviz/tq?gid=', //xera
                'https://docs.google.com/spreadsheets/d/19N3mkRwI4wrY1b84yVjbkOj3Lt-qG-xpq2iUPpYTDQU/gviz/tq?gid=', //cairn
                'https://docs.google.com/spreadsheets/d/1z7QRf-vO_jA60w9xtJqh64URPArrQNLL6HPtk8WJ4PY/gviz/tq?gid=', //mo
                'https://docs.google.com/spreadsheets/d/1KwuXDkfleVrcSp6GbWF-GlLC9c2-slphRkD5jRxbIbc/gviz/tq?gid=', //sam
                'https://docs.google.com/spreadsheets/d/15qrugyur2zX27IuzcWdJgwpKfkay2FNTzuIA-YsJ8WY/gviz/tq?gid=', //deim
                'https://docs.google.com/spreadsheets/d/1vxyXvP2cZf-m-HsZCvY7Yv-rrqHGAvN66-KYmX4g3yo/gviz/tq?gid=', //sh
                'https://docs.google.com/spreadsheets/d/15Bx8GtDL2xyD6OWCQNHLKG2YD98HTkGcmSb0UMIDxZ8/gviz/tq?gid='  //dhuum10
                ];

var bossGID = [vgGID, gorseGID, sabGID, slothGID, matthiasGID, kcGID, xeraGID, cairnGID, moGID, samGID, deimGID, shGID, dhuumGID];
var selectedBoss = vgGID;
var bossSelection = 0;
var classSelection = 0;
var GID = 991015174;
var sheetLink = 'https://docs.google.com/spreadsheets/d/1L6Z8UZNQvgLi1Ve9ybmUjD6yLdDIz4D65c4FfQB3Sec/gviz/tq?gid=';

//chart specific
var scatterOptions = null;
var tableWrapper = null;
var scatterWrapper = null;
var retalWrapper = null;
var scourgeWrapper = null;
var sabWrapper = null;
var slothWrapper = null;

//for queries
var dataTableArray = [null, null, null];
var dataArray = [null, null, null];

// Load the Visualization API and the corechart package.
google.charts.load('current', {'packages': ['corechart']});
google.charts.load('current', {'packages': ['table']});

// clear old charts
function clearChart(){
  while (chart_table_div.firstChild) {
    chart_table_div.removeChild(chart_table_div.firstChild);
  }
  while (chart_div.firstChild) {
    chart_div.removeChild(chart_div.firstChild);
  }
  while (retal.firstChild) {
    retal.removeChild(retal.firstChild);
  }
  while (scourge.firstChild) {
    scourge.removeChild(scourge.firstChild);
  }
  while (bossMech.firstChild) {
    bossMech.removeChild(bossMech.firstChild);
  }
}

//Case to get each table
function caseSelection(bossID, classID) {
  clearChart();
  bossID = parseInt(bossID);
  classID = parseInt(classID);
  var queryString = 'SELECT B, C OFFSET 0';
  var helperArray = [2, 3, 12];
  var sabArray = [0, 2, 3, 4, 7, 8, 9, 10];
  drawTableVisualization();

  if (classID != 0){
    dpsScatterChart();
  }
  //Guardian
  if(classID == 9) {
    retalScatterChart();
    return;
  }
  //Scourge
  else if(classID == 7 && !(helperArray.indexOf(bossID) >= 0)) {
    console.log
    scourgeScatterChart();
    return;
  }

  // Sabetha
  if(bossID == 2 && (sabArray.indexOf(classID) == -1)){
    sabScatterChart();
    return;
  }

  // Slothasor
  else if(bossID == 3 && (sabArray.indexOf(classID) == -1)){
    slothScatterChart();
    return;
  }

  switch(bossID + '_' + classID)
    {
    case '1_1':
      break;
    default:
      return;
    }
  return;
}

//DPS Table
function drawTableVisualization() {
  tableWrapper = new google.visualization.ChartWrapper({
    'chartType': 'Table',
    'dataSourceUrl': sheetLink + GID + '&headers=1&tq=',
    'query': '',
    'containerId': 'chart_table_div'
  });

  google.visualization.events.addListener(tableWrapper, 'error', function() {
    google.visualization.errors.removeAll(document.getElementById(tableWrapper.getContainerId()));
  });
  tableWrapper.draw();
}

//DPS Scatter
function dpsScatterChart() {
  scatterWrapper = new google.visualization.ChartWrapper({
    'chartType': 'ScatterChart',
    'dataSourceUrl': sheetLink + GID + '&headers=1&tq=',
    'query': 'SELECT B, C OFFSET 0',
    'containerId': 'chart_div',
    'options': {title: 'DPS on LI',
                vAxis: {title: 'DPS',
                        format: 'short',
                        minValue: 0},
                hAxis: {title:'LI',
                        format: 'short',
                        minValue: 0}}
    });
  google.visualization.events.addListener(scatterWrapper, 'error', function() {
    google.visualization.errors.removeAll(document.getElementById(scatterWrapper.getContainerId()));
  });
  scatterWrapper.draw();
}

//Retal plot
function retalScatterChart() {
  retalWrapper = new google.visualization.ChartWrapper({
    'chartType': 'ScatterChart',
    'dataSourceUrl': sheetLink + GID + '&headers=1&tq=',
    'query': 'SELECT D, C',
    'containerId': 'retal',
    'options': {title: 'Retal',
                vAxis: {title: 'DPS',
                        format: 'short',
                        minValue: 0},
                hAxis: {title:'Retal',
                        format: 'short',
                        minValue: 0}}
  });
  google.visualization.events.addListener(retalWrapper, 'error', function() {
    google.visualization.errors.removeAll(document.getElementById(retalWrapper.getContainerId()));
  });
  retalWrapper.draw();
}

//Scourge plot
function scourgeScatterChart(){
  scourgeWrapper = new google.visualization.ChartWrapper({
    'chartType': 'ScatterChart',
    'dataSourceUrl': sheetLink + GID + '&headers=1&tq=',
    'containerId': 'scourge',
    'options': {title: 'Epi Bouncing',
                series: {
                  0: {targetAxisIndex: 0,
                      labelInLegend: 'Epi to Boss',
                      pointSize: 5},
                  1: {targetAxisIndex: 0,
                      labelInLegend: 'Epi from Boss',
                      pointSize: 5},
                  2: {targetAxisIndex: 0,
                      labelInLegend: 'No Epi',
                      pointSize: 5},
                },
                vAxis: {
                  title: 'DPS',
                  format: 'short',
                  minValue: 0
                },
                hAxis: {
                  title: 'LI',
                  format: 'short',
                  minValue: 0
                }
               }
  });

  var data1 = dataArray[0];
  var data2 = dataArray[1];
  var data3 = dataArray[2];
  var joinData = null;

  // send queries for different epi bouncing dps
  var query = new google.visualization.Query(sheetLink + GID + '&headers=1&tq=' + 'SELECT B, C WHERE D CONTAINS "to"');
  query.send(handleQueryResponseDt1);

  query = new google.visualization.Query(sheetLink + GID + '&headers=1&tq=' + 'SELECT B, C WHERE D CONTAINS "from"');
  query.send(handleQueryResponseDt2);

  query = new google.visualization.Query(sheetLink + GID + '&headers=1&tq=' + 'SELECT B, C WHERE D CONTAINS "No"');
  query.send(handleQueryResponseDt3);

  joinData = google.visualization.data.join(data1, data2, 'full', [[0,0]], [1], [1]);

  joinData = google.visualization.data.join(joinData, data3, 'full', [[0,0]], [1,2], [1]);

  scourgeWrapper.setDataTable(joinData);

  scourgeWrapper.draw();
}

//Sabetha plot
function sabScatterChart(){
  sabWrapper = new google.visualization.ChartWrapper({
    'chartType': 'ScatterChart',
    'dataSourceUrl': sheetLink + GID + '&headers=1&tq=',
    'containerId': 'bossMech',
    'options': {title: 'Cannon DPS',
                series: {
                  0: {targetAxisIndex: 0,
                      labelInLegend: 'No Cannons',
                      pointSize: 5},
                  1: {targetAxisIndex: 0,
                      labelInLegend: 'Cannons',
                      pointSize: 5},
                },
                vAxis: {
                  title: 'DPS',
                  format: 'short',
                  minValue: 0
                },
                hAxis: {
                  title: 'LI',
                  format: 'short',
                  minValue: 0
                }
               }
  });

  var data1 = dataArray[0];
  var data2 = dataArray[1];

  // send queries for different epi bouncing dps
  var query = new google.visualization.Query(sheetLink + GID + '&headers=1&tq=' + 'SELECT B, C WHERE D CONTAINS "No"');
  query.send(handleQueryResponseDt1);

  query = new google.visualization.Query(sheetLink + GID + '&headers=1&tq=' + 'SELECT B, C WHERE D CONTAINS "-"');
  query.send(handleQueryResponseDt2);

  joinData = google.visualization.data.join(data1, data2, 'full', [[0,0]], [1], [1]);

  sabWrapper.setDataTable(joinData);

  sabWrapper.draw();
}

//Slot plot
function slothScatterChart(){
  sloWrapper = new google.visualization.ChartWrapper({
    'chartType': 'ScatterChart',
    'dataSourceUrl': sheetLink + GID + '&headers=1&tq=',
    'containerId': 'bossMech',
    'options': {title: 'Shroom DPS',
                series: {
                  0: {targetAxisIndex: 0,
                      labelInLegend: 'No Shroom',
                      pointSize: 5},
                  1: {targetAxisIndex: 0,
                      labelInLegend: 'Shroom',
                      pointSize: 5},
                },
                vAxis: {
                  title: 'DPS',
                  format: 'short',
                  minValue: 0
                },
                hAxis: {
                  title: 'LI',
                  format: 'short',
                  minValue: 0
                }
               }
  });

  var data1 = dataArray[0];
  var data2 = dataArray[1];

  // send queries for different epi bouncing dps
  var query = new google.visualization.Query(sheetLink + GID + '&headers=1&tq=' + 'SELECT B, C WHERE D CONTAINS "0"');
  query.send(handleQueryResponseDt1);

  query = new google.visualization.Query(sheetLink + GID + '&headers=1&tq=' + 'SELECT B, C WHERE D !CONTAINS "0"');
  query.send(handleQueryResponseDt2);

  joinData = google.visualization.data.join(data1, data2, 'full', [[0,0]], [1], [1]);

  slothWrapper.setDataTable(joinData);

  slothWrapper.draw();
}

function drawCandleVisualization() {
  candleWrapper = new google.visualization.candleWrapper({

  });
  google.visualization.events.addListener(candleWrapper, 'error', function() {
    google.visualization.errors.removeAll(document.getElementById(candleWrapper.getContainerId()));
  });
  candleWrapper.draw();
}

function drawStackedBarVisualization() {
  stackedBarWrapper = new google.visualization.stackedBarWrapper({

  });
  google.visualization.events.addListener(stackedBarWrapper, 'error', function() {
    google.visualization.errors.removeAll(document.getElementById(stackedBarWrapper.getContainerId()));
  });
  stackedBarWrapper.draw();
}

function handleQueryResponseDt1(response){
  dataArray[0] = response.getDataTable();
}

function handleQueryResponseDt2(response){
  dataArray[1] = response.getDataTable();
}

function handleQueryResponseDt3(response){
  dataArray[2] = response.getDataTable();
}

window.onload = function() {
  document.getElementById("press").onclick = function(){
    generateTables();
  };
};

function generateTables() {
    classSelection = document.getElementById("menu").value;
    bossSelection = document.getElementById("bossSelect").value;
    selectedBoss = bossGID[bossSelection];
    GID = selectedBoss[classSelection];
    sheetLink = bossSheet[bossSelection];
    caseSelection(bossSelection, classSelection);
}
